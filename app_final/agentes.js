document.addEventListener('DOMContentLoaded', () => {
    const mainContent = document.querySelector('.agents-container');
    const header = document.querySelector('.main-header');
    const customLoginBtn = document.getElementById('custom-login-btn');

    // Ocultar contenido principal y bot√≥n de login por defecto
    mainContent.style.display = 'none';
    header.style.display = 'none';
    customLoginBtn.style.display = 'none';

    // Netlify Identity Widget Listeners
    netlifyIdentity.on('init', user => {
        if (user) {
            showContent(user);
        } else {
            showLoginButton();
        }
    });

    netlifyIdentity.on('login', user => {
        showContent(user);
        netlifyIdentity.close();
    });

    netlifyIdentity.on('logout', () => {
        mainContent.style.display = 'none';
        header.style.display = 'none';
        showLoginButton();
    });

    // Funci√≥n para mostrar el contenido principal
    function showContent(user) {
        mainContent.style.display = 'grid';
        header.style.display = 'block';
        customLoginBtn.style.display = 'none'; // Ocultar bot√≥n de login si ya est√° logueado
    }

    // Funci√≥n para mostrar el bot√≥n de login
    function showLoginButton() {
        customLoginBtn.style.display = 'block';
    }

    // Event listener para el bot√≥n de login personalizado
    customLoginBtn.addEventListener('click', () => {
        netlifyIdentity.open();
    });

    // --- El c√≥digo para el modal y los prompts ---
    const agentCards = document.querySelectorAll('.agent-card');
    const modal = document.getElementById('prompt-modal');
    const modalContent = document.getElementById('prompt-details');
    const closeModalBtn = document.getElementById('modal-close-btn');

    const agentsData = {
        creativo: {
            title: '‚ú® Agente Creativo (Coach Anti-Bloqueo)',
            prompts: [
                {
                    title: 'El prompt \'Coach Anti-Bloqueo\'',
                    content: `Act√∫a como mi coach de creatividad y estratega de contenido. Soy un agente inmobiliario y a veces me bloqueo y no s√© qu√© publicar.\n\nTu √∫nica misi√≥n es ayudarme a encontrar una idea potente y espec√≠fica para mi pr√≥ximo contenido (un post, un v√≠deo, etc.). No debes escribir el contenido final, solo debes ayudarme a generar el TEMA a trav√©s de una conversaci√≥n.\n\nTu m√©todo de coaching es el siguiente:\n1. Me har√°s preguntas inteligentes, una a la vez, para guiarme.\n2. Empezar√°s con una pregunta amplia sobre mi objetivo general.\n3. Basado en mi respuesta, profundizar√°s con preguntas sobre mi d√≠a a d√≠a: el mercado local, conversaciones con clientes, √©xitos o frustraciones recientes.\n4. Al final de nuestra conversaci√≥n, resumir√°s la idea que hemos generado en una sola frase clara y me sugerir√°s a qu√© otro agente (de Propiedades, Redes Sociales, V√≠deo o Email) deber√≠a llevar esta idea para crear el contenido.\n\nPara empezar nuestra sesi√≥n de coaching, pres√©ntate brevemente como mi \'Coach Anti-Bloqueo\' y hazme tu primera pregunta.`
                }
            ]
        },
        propiedades: {
            title: 'üè† Agente de Propiedades',
            prompts: [
                {
                    title: 'Prompt: Directo al Deseo',
                    content: `Act√∫a como un copywriter de √©lite para marcas inmobiliarias de prestigio, con un estilo similar al de las revistas de dise√±o como Architectural Digest. Tu objetivo es crear una descripci√≥n que sea vibrante, sofisticada y que venda un estilo de vida deseable. Usa frases potentes y un lenguaje que evoque exclusividad y beneficios claros. S√© inspirador, no novelesco.\n\nAqu√≠ est√°n los detalles de la propiedad:\n- Tipo de Propiedad: [Ej: Piso con encanto]\n- Direcci√≥n: [Ej: Carrer de la Perla, 32, Gr√†cia, Barcelona]\n- Metros cuadrados: [Ej: 75]\n- Habitaciones: [Ej: 2]\n- Ba√±os: [Ej: 1]\n- Caracter√≠sticas clave (3-5): [Ej: Balc√≥n soleado, suelos de mosaico hidr√°ulico, cocina abierta de dise√±o, techos altos con vigas de madera.]\n- Estilo/Ambiente: [Ej: Bohemio y acogedor]\n- P√∫blico objetivo: [Ej: Parejas j√≥venes o profesionales creativos]\n\nEstructura el texto de la siguiente manera:\n\n1.  **Titular Atractivo:** Un t√≠tulo corto que resuma la esencia de la propiedad.\n2.  **P√°rrafo de Apertura (La Promesa):** En dos o tres frases, define la experiencia central de vivir aqu√≠. ¬øQu√© sue√±o cumple esta propiedad?\n3.  **Puntos de Experiencia (3 vi√±etas):** Describe los 3 beneficios m√°s potentes en 3 vi√±etas (bullet points). Cada vi√±eta debe empezar con un t√≠tulo en negrita.\n    *   **El Espacio Interior:** Habla del dise√±o, la luz y la atm√≥sfera.\n    *   **Tu Rinc√≥n Privado:** Describe el balc√≥n/terraza y su uso ideal.\n    *   **El Pulso del Barrio:** Habla de la vida en la zona y su energ√≠a.\n4.  **Llamada a la Acci√≥n (Exclusiva y Directa):** Una frase final, clara y que invite a una acci√≥n concreta.`
                }
            ]
        },
        redes: {
            title: 'üì± Agente de Redes Sociales',
            prompts: [
                {
                    title: 'Prompt: Anunciar Nueva Propiedad',
                    content: `Act√∫a como un social media manager experto en el sector inmobiliario de lujo. Crea el texto para un post de Instagram y Facebook anunciando una nueva propiedad. El formato ideal es un carrusel de im√°genes.\n\nDetalles de la propiedad:\n- Tipo de Propiedad y Titular: [Ej: Apartamento de dise√±o a estrenar]\n- Ubicaci√≥n (Barrio/Ciudad): [Ej: La Dreta de l\'Eixample, Barcelona]\n- 3 Caracter√≠sticas Estrella: [1. Acabados de lujo Porcelanosa, 2. Sistema de dom√≥tica integrado, 3. Terraza privada de 20m¬≤]\n- A qui√©n le encantar√≠a vivir aqu√≠: [Ej: Un profesional o una pareja que busque lujo, tecnolog√≠a y una ubicaci√≥n inmejorable.]\n- Enlace de contacto/m√°s info: [Ej: \'el enlace en nuestra bio\']\n\nGenera el siguiente contenido:\n1.  **Texto del Post:** Un texto principal (3-4 p√°rrafos cortos) que sea atractivo y termine con una pregunta para fomentar la interacci√≥n.\n2.  **Sugerencias para Carrusel (5 diapositivas):** Describe brevemente qu√© imagen o v√≠deo corto poner en cada una de las 5 diapositivas del carrusel para contar una historia visual.\n3.  **Hashtags:** Una lista de 10-15 hashtags relevantes (mezclando populares y de nicho).`
                },
                {
                    title: 'Prompt: Tu Voz de Autoridad',
                    content: `Act√∫a como un estratega de marca personal para agentes inmobiliarios. El objetivo es crear un post de \'Consejo de la Semana\' para Instagram o Facebook que posicione al agente como un experto de confianza.\n\nInformaci√≥n del Agente:\n- Nombre del Agente: [Tu Nombre]\n- Tu especialidad: [Ej: Ayudar a familias a encontrar su primera casa, experto en el mercado de lujo de Marbella, etc.]\n- Tema del consejo de hoy: [Ej: \'Un error com√∫n al negociar el precio de compra\', \'La importancia del home staging\', \'La mejor √©poca del a√±o para vender tu casa\']\n\nEscribe un post que siga esta estructura:\n1.  **Gancho Fuerte:** Una pregunta o afirmaci√≥n que capte la atenci√≥n inmediatamente.\n2.  **Desarrollo del Consejo:** Explica el consejo de forma clara, sencilla y directa. Usa una lista de 2-3 puntos si es necesario.\n3.  **Cierre con Autoridad:** Termina con una frase que refuerce tu experiencia y una llamada a la interacci√≥n (ej: \'¬øEst√°s de acuerdo? ¬°Te leo en los comentarios!\').\n4.  **Idea para la imagen:** Sugiere una idea para la foto o el gr√°fico que acompa√±ar√≠a al texto.`
                },
                {
                    title: 'Prompt: Im√°n de Clientes (Din√°mico)',
                    content: `Act√∫a como un experto en marketing de respuesta directa. Crea el texto para un anuncio en Instagram/Facebook con el objetivo de captar emails de clientes potenciales. La oferta es una gu√≠a gratuita en PDF.\n\nDetalles de la Gu√≠a:\n- T√≠tulo de la Gu√≠a: [Ej: \'La Gu√≠a Definitiva para Comprar tu Primera Casa en [A√±o Actual]\']\n- A√±o Actual: [Escribe aqu√≠ el a√±o en curso, ej: 2025]\n- Principal problema que resuelve: [Ej: El miedo y la confusi√≥n del proceso de compra]\n- 3 Beneficios clave de la gu√≠a: [1. Checklist paso a paso, 2. Errores a evitar, 3. Claves para negociar]\n- P√∫blico objetivo: [Ej: Compradores primerizos, inversores, etc.]\n\nGenera un texto de anuncio que:\n1.  Hable directamente al dolor del p√∫blico objetivo.\n2.  Presente la gu√≠a como la soluci√≥n definitiva.\n3.  Liste los 3 beneficios clave en un formato atractivo (ej. con emojis).\n4.  Tenga una llamada a la acci√≥n muy clara y directa para descargar la gu√≠a (ej: \'Haz clic en el enlace de mi perfil para descargarla GRATIS ahora\').`
                }
            ]
        },
        video: {
            title: 'üé¨ Agente de V√≠deo',
            prompts: [
                {
                    title: 'Prompt: Director de Reels',
                    content: `Act√∫a como un director y guionista de v√≠deos virales para redes sociales, especializado en contenido de confianza. Tu misi√≥n es crear un guion detallado para un v√≠deo de 60 segundos.\n\nEl tema del v√≠deo es: [Escribe aqu√≠ el tema]\nEl p√∫blico objetivo son: [Describe aqu√≠ al p√∫blico]\nEl tono debe ser: [Ej: Tranquilizador, claro y muy emp√°tico.]\n\nGenera un guion estructurado por escenas, segundo a segundo, que incluya:\n1.  **La acci√≥n o el plano visual** (lo que se ve en c√°mara).\n2.  **El di√°logo** (lo que digo a c√°mara).\n3.  **El texto que aparece en pantalla**.\n\nAqu√≠ tienes la estructura:\n\n- **Escena 1: El Gancho (0-5 segundos)**\n- **Escena 2: El Problema (5-20 segundos)**\n- **Escena 3: La Soluci√≥n en 3 Pasos (20-50 segundos)**\n- **Escena 4: La Llamada a la Acci√≥n (50-60 segundos)**`
                },
                {
                    title: 'Prompt: Productor de YouTube (Completo)',
                    content: `Act√∫a como un productor de contenido para un canal de YouTube de √©xito, especializado en explicar temas complejos de forma sencilla y fiable.\n\nMi objetivo es crear el guion para un v√≠deo de entre 5 y 8 minutos.\nEl tema del v√≠deo es: [Escribe aqu√≠ el tema]\nEl p√∫blico objetivo son: [Describe aqu√≠ al p√∫blico]\n- El tono debe ser: [Ej: Claro, paciente, did√°ctico]\n\nGenera una estructura completa para el v√≠deo, que incluya:\n1.  **T√≠tulo del V√≠deo:** Un t√≠tulo optimizado para b√∫squedas en YouTube (SEO).\n2.  **Guion del V√≠deo:** Un guion detallado, dividido en secciones (Hook, Introducci√≥n, Cuerpo del v√≠deo, Resumen, CTA). Para cada parte, describe el di√°logo y las ideas para los elementos visuales.\n3.  **Descripci√≥n para YouTube:** Un texto para la descripci√≥n del v√≠deo, que incluya un resumen del contenido, timestamps para cada secci√≥n del guion y un espacio para enlaces relevantes.\n4.  **Ideas para la Miniatura (Thumbnail):** 2 conceptos diferentes para una miniatura atractiva, especificando el texto y la imagen a usar para maximizar los clics.`
                }
            ]
        },
        email: {
            title: 'üìß Agente de Email Marketing',
            prompts: [
                {
                    title: 'Prompt: Constructor de Confianza',
                    content: `Act√∫a como un experto en email marketing y copywriting para el sector inmobiliario. Mi objetivo es crear una secuencia de bienvenida autom√°tica de 3 correos para las personas que se descargan mi gu√≠a gratuita.\n\nDetalles para la secuencia:\n- Mi Nombre: [Tu Nombre]\n- Nombre de la Gu√≠a que descargaron: [Ej: \'La Gu√≠a Definitiva para Comprar tu Primera Casa\']\n- Mi especialidad como agente: [Ej: \'ayudar a familias a encontrar la casa de sus sue√±os en la zona norte\']\n- Tono: Cercano, profesional y muy √∫til. Nada de venta agresiva.\n\nGenera los 3 correos siguientes:\n- **Email 1 (Inmediato):** Entregar la gu√≠a. Asunto y cuerpo del email.\n- **Email 2 (2 d√≠as despu√©s):** Aportar valor extra. Asunto y cuerpo.\n- **Email 3 (4 d√≠as despu√©s):** Presentaci√≥n personal y llamada a la acci√≥n suave. Asunto y cuerpo.`
                },
                {
                    title: 'Prompt: Newsletter de Impacto',
                    content: `Act√∫a como un copywriter inmobiliario. Escribe un email para mi lista de suscriptores anunciando una nueva propiedad exclusiva.\n\nDetalles de la propiedad:\n- Titular del anuncio: [Ej: \'√Åtico con terraza de vistas panor√°micas en El Born\']\n- 3 Puntos Fuertes: [1. Terraza de 40m¬≤, 2. Completamente reformado con dise√±o de lujo, 3. Luz natural todo el d√≠a]\n- Un detalle √∫nico o emocional: [Ej: \'Es el lugar perfecto para ver los atardeceres sobre la ciudad\']\n- Enlace a la ficha completa (fotos, etc.): [Pega aqu√≠ el enlace]\n\nEl email debe tener:\n1.  **Un Asunto Atractivo:** Corto y que genere curiosidad.\n2.  **Un P√°rrafo de Apertura:** Que conecte con el deseo del lector.\n3.  **Los 3 Puntos Fuertes:** Presentados en una lista f√°cil de leer (con vi√±etas).\n4.  **Una Llamada a la Acci√≥n (CTA) Clara:** Que invite a hacer clic en el enlace para ver m√°s.`
                },
                {
                    title: 'Prompt: Hola, ¬øsigues ah√≠?',
                    content: `Act√∫a como un agente inmobiliario que quiere reconectar con un lead que no ha interactuado en los √∫ltimos 3 meses. El objetivo NO es vender, sino reactivar la conversaci√≥n de forma genuina y √∫til.\n\nMis datos:\n- Mi Nombre: [Tu Nombre]\n- Un recurso √∫til que he creado recientemente: [Ej: \'un nuevo v√≠deo de YouTube sobre c√≥mo ha cambiado el mercado este trimestre\']\n- Enlace al recurso: [Pega aqu√≠ el enlace]\n\nEscribe un email que cumpla con lo siguiente:\n1.  **Asunto Personal:** Que no suene a marketing masivo (ej: \'Una pregunta r√°pida\').\n2.  **Cuerpo del Email Corto y Directo:**\n    - Recu√©rdale brevemente qui√©n eres.\n    - Menciona que ha pasado un tiempo.\n    - Ofr√©cele el recurso √∫til sin pedir nada a cambio.\n    - Termina con una pregunta abierta y sencilla para que sea f√°cil responder (ej: \'¬øSigues buscando en la misma zona o han cambiado tus planes?\').`
                }
            ]
        }
    };

    agentCards.forEach(card => {
        card.addEventListener('click', () => {
            const agentId = card.dataset.agent;
            const data = agentsData[agentId];

            let htmlContent = `<h2>${data.title}</h2>`;
            data.prompts.forEach(prompt => {
                htmlContent += `
                    <div class="prompt-item">
                        <h3>${prompt.title}</h3>
                        <pre><code>${escapeHtml(prompt.content)}</code></pre>
                        <button class="copy-btn">Copiar Prompt</button>
                    </div>
                `;
            });

            modalContent.innerHTML = htmlContent;
            modal.className = 'modal-visible';
        });
    });

    closeModalBtn.addEventListener('click', () => {
        modal.className = 'modal-hidden';
    });

    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.className = 'modal-hidden';
        }
    });
    
    document.addEventListener('click', function(event){
        if (event.target.classList.contains('copy-btn')){
            const codeElement = event.target.previousElementSibling.querySelector('code');
            const codeToCopy = codeElement.innerText;
            navigator.clipboard.writeText(codeToCopy).then(() => {
                event.target.innerText = '¬°Copiado!';
                setTimeout(() => {
                    event.target.innerText = 'Copiar Prompt';
                }, 2000);
            }).catch(err => {
                console.error('Error al copiar: ', err);
            });
        }
    });

    function escapeHtml(unsafe) {
        return unsafe
             .replace(/&/g, "&amp;")
             .replace(/</g, "&lt;")
             .replace(/>/g, "&gt;")
             .replace(/"/g, "&quot;")
             .replace(/'/g, "&#039;");
     }
});